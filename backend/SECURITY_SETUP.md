# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ CloverdashBot Backend

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ª—è JWT

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
python generate_secret_key.py

# –∏–ª–∏ —á–µ—Ä–µ–∑ make
make secret-key
```

### –ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ

–°–∫—Ä–∏–ø—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∫–ª—é—á–µ–π:

1. **Base64 –∫–ª—é—á (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)** - 32 –±–∞–π—Ç–∞ –≤ base64
2. **–î–ª–∏–Ω–Ω—ã–π Base64 –∫–ª—é—á** - 64 –±–∞–π—Ç–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
3. **–ê–ª—Ñ–∞–≤–∏—Ç–Ω–æ-—Ü–∏—Ñ—Ä–æ–≤–æ–π –∫–ª—é—á** - 64 —Å–∏–º–≤–æ–ª–∞ –∏–∑ –±—É–∫–≤ –∏ —Ü–∏—Ñ—Ä

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π –≤ –≤–∞—à `.env` —Ñ–∞–π–ª:

```env
# –ó–∞–º–µ–Ω–∏—Ç–µ your-secret-key-here –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á
SECRET_KEY=rF66tU5rWBkq4KoD70jSNsy956NSSTtkaFzNHPWT_N8=
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=43200
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|---------|
| `SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤ | `rF66tU5r...` |
| `ALGORITHM` | –ê–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è HS256) | `HS256` |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö | `43200` (30 –¥–Ω–µ–π) |

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```env
# CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
ALLOWED_ORIGINS=["http://localhost:3000", "https://yourdomain.com"]

# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
ALLOWED_ORIGINS=["*"]
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üü¢ –ß—Ç–æ –¥–µ–ª–∞—Ç—å

1. **–ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ CORS** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

### üî¥ –ß–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å

1. ‚ùå **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ** `.env` —Ñ–∞–π–ª—ã –≤ Git
2. ‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
3. ‚ùå **–ù–µ –¥–µ–ª–∏—Ç–µ—Å—å** —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
4. ‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** –ø—Ä–æ—Å—Ç—ã–µ –∏–ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –∫–ª—é—á–∏
5. ‚ùå **–ù–µ –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ** `ALLOWED_ORIGINS=["*"]` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## –†–∞–∑–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (.env.development)
```env
SECRET_KEY=dev-key-here-can-be-simpler-but-still-secure
ACCESS_TOKEN_EXPIRE_MINUTES=1440  # 1 –¥–µ–Ω—å
ALLOWED_ORIGINS=["*"]
```

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω (.env.production)
```env
SECRET_KEY=super-secure-production-key-very-long-and-random
ACCESS_TOKEN_EXPIRE_MINUTES=43200  # 30 –¥–Ω–µ–π
ALLOWED_ORIGINS=["https://yourdomain.com"]
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (.env.test)
```env
SECRET_KEY=test-key-for-testing-environment
ACCESS_TOKEN_EXPIRE_MINUTES=60  # 1 —á–∞—Å
ALLOWED_ORIGINS=["*"]
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python main.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint
curl http://localhost:8000/health/

# –¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401)
curl http://localhost:8000/database/schema
```

### –¢–µ—Å—Ç JWT —Ç–æ–∫–µ–Ω–æ–≤

```python
# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
from services.security import security_service

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
token = security_service.create_access_token({"sub": "test_user_id"})
print(f"Token: {token}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
token_data = security_service.verify_token(token)
print(f"User ID: {token_data.user_id}")
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "Could not validate credentials"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `SECRET_KEY` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞: `Authorization: Bearer YOUR_TOKEN`

### –û—à–∏–±–∫–∞ CORS

1. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ `ALLOWED_ORIGINS`
2. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `["*"]`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª (http/https)

### –¢–æ–∫–µ–Ω—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –≤—ã –º–µ–Ω—è–ª–∏ `SECRET_KEY`
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–∫–µ–Ω—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –õ–æ–≥–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:

```bash
# –§–∏–ª—å—Ç—Ä –ª–æ–≥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
docker logs backend_container | grep "auth"

# –ò–ª–∏ –≤ —Ñ–∞–π–ª–∞—Ö –ª–æ–≥–æ–≤
tail -f /path/to/logs/app.log | grep "Failed\|Unauthorized"
```

### –ú–µ—Ç—Ä–∏–∫–∏

–°–ª–µ–¥–∏—Ç–µ –∑–∞:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º–∏ IP –∞–¥—Ä–µ—Å–∞–º–∏ 